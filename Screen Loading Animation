-- Sky-Base-Maker Loading Animation Script for Roblox
-- Sử dụng local, if, then như yêu cầu

local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Tạo ScreenGui chính
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SkyBaseLoadingGui"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Background Frame với gradient sky tối
local backgroundFrame = Instance.new("Frame")
backgroundFrame.Name = "Background"
backgroundFrame.Size = UDim2.new(1, 0, 1, 0)
backgroundFrame.Position = UDim2.new(0, 0, 0, 0)
backgroundFrame.BorderSizePixel = 0
backgroundFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 15) -- Dark background như trong ảnh
backgroundFrame.Parent = screenGui

-- Frame chứa các hiệu ứng hạt
local particleFrame = Instance.new("Frame")
particleFrame.Name = "ParticleContainer"
particleFrame.Size = UDim2.new(1, 0, 1, 0)
particleFrame.Position = UDim2.new(0, 0, 0, 0)
particleFrame.BackgroundTransparency = 1
particleFrame.Parent = screenGui

-- Frame trung tâm chứa logo và text
local centerFrame = Instance.new("Frame")
centerFrame.Name = "CenterContent"
centerFrame.Size = UDim2.new(0, 400, 0, 300)
centerFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
centerFrame.BackgroundTransparency = 1
centerFrame.Parent = screenGui

-- Tạo logo đám mây gradient như trong ảnh
local cloudLogo = Instance.new("Frame")
cloudLogo.Name = "CloudLogo"
cloudLogo.Size = UDim2.new(0, 160, 0, 100)
cloudLogo.Position = UDim2.new(0.5, -80, 0, 10)
cloudLogo.BackgroundTransparency = 1
cloudLogo.Parent = centerFrame

-- Tạo đám mây chính với gradient cyan -> blue -> purple -> pink
local mainCloud = Instance.new("Frame")
mainCloud.Size = UDim2.new(0, 140, 0, 70)
mainCloud.Position = UDim2.new(0.5, -70, 0.5, -35)
mainCloud.BorderSizePixel = 0
mainCloud.Parent = cloudLogo

-- UICorner cho đám mây
local cloudCorner = Instance.new("UICorner")
cloudCorner.CornerRadius = UDim.new(0.5, 0)
cloudCorner.Parent = mainCloud

-- Gradient giống như trong ảnh
local cloudGradient = Instance.new("UIGradient")
cloudGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 255, 255)),    -- Cyan
    ColorSequenceKeypoint.new(0.3, Color3.fromRGB(0, 150, 255)),  -- Blue
    ColorSequenceKeypoint.new(0.7, Color3.fromRGB(150, 100, 255)), -- Purple
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 100, 150))   -- Pink
}
cloudGradient.Rotation = 45
cloudGradient.Parent = mainCloud

-- Các đám mây nhỏ bổ sung
local smallCloud1 = Instance.new("Frame")
smallCloud1.Size = UDim2.new(0, 50, 0, 35)
smallCloud1.Position = UDim2.new(0, 20, 0, 10)
smallCloud1.BorderSizePixel = 0
smallCloud1.Parent = cloudLogo

local corner1 = Instance.new("UICorner")
corner1.CornerRadius = UDim.new(0.5, 0)
corner1.Parent = smallCloud1

local grad1 = Instance.new("UIGradient")
grad1.Color = cloudGradient.Color
grad1.Rotation = 45
grad1.Parent = smallCloud1

local smallCloud2 = Instance.new("Frame")
smallCloud2.Size = UDim2.new(0, 45, 0, 30)
smallCloud2.Position = UDim2.new(0, 95, 0, 15)
smallCloud2.BorderSizePixel = 0
smallCloud2.Parent = cloudLogo

local corner2 = Instance.new("UICorner")
corner2.CornerRadius = UDim.new(0.5, 0)
corner2.Parent = smallCloud2

local grad2 = Instance.new("UIGradient")
grad2.Color = cloudGradient.Color
grad2.Rotation = 45
grad2.Parent = smallCloud2

-- Container cho từng chữ cái
local textContainer = Instance.new("Frame")
textContainer.Name = "TextContainer"
textContainer.Size = UDim2.new(1, 0, 0, 60)
textContainer.Position = UDim2.new(0, 0, 0, 130)
textContainer.BackgroundTransparency = 1
textContainer.Parent = centerFrame

-- Tạo từng chữ cái riêng biệt
local text = "SKY-BASE-MAKER"
local letters = {}
local letterWidth = 400 / #text

for i = 1, #text do
    local letter = Instance.new("TextLabel")
    letter.Name = "Letter" .. i
    letter.Size = UDim2.new(0, letterWidth, 1, 0)
    letter.Position = UDim2.new(0, (i-1) * letterWidth, 0, 0)
    letter.BackgroundTransparency = 1
    letter.Text = string.sub(text, i, i)
    letter.TextSize = 30
    letter.TextScaled = true
    letter.Font = Enum.Font.LuckiestGuy
    letter.Parent = textContainer
    
    -- Gradient cho chữ giống như logo
    local letterGradient = Instance.new("UIGradient")
    letterGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 255, 255)),    -- Cyan
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 150, 255)), -- Blue-Purple
        ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 100, 200))   -- Pink
    }
    letterGradient.Rotation = 90
    letterGradient.Parent = letter
    
    -- Text stroke cho hiệu ứng đẹp hơn
    local textStroke = Instance.new("UIStroke")
    textStroke.Color = Color3.fromRGB(0, 50, 100)
    textStroke.Thickness = 2
    textStroke.Parent = letter
    
    table.insert(letters, letter)
end

-- Loading progress bar
local progressFrame = Instance.new("Frame")
progressFrame.Name = "ProgressFrame"
progressFrame.Size = UDim2.new(0, 200, 0, 4)
progressFrame.Position = UDim2.new(0.5, -100, 0, 210)
progressFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
progressFrame.BorderSizePixel = 0
progressFrame.Parent = centerFrame

local progressCorner = Instance.new("UICorner")
progressCorner.CornerRadius = UDim.new(0, 2)
progressCorner.Parent = progressFrame

local progressBar = Instance.new("Frame")
progressBar.Name = "ProgressBar"
progressBar.Size = UDim2.new(0, 0, 1, 0)
progressBar.Position = UDim2.new(0, 0, 0, 0)
progressBar.BorderSizePixel = 0
progressBar.Parent = progressFrame

local progressGradient = Instance.new("UIGradient")
progressGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 255, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 100, 200))
}
progressGradient.Parent = progressBar

local progressBarCorner = Instance.new("UICorner")
progressBarCorner.CornerRadius = UDim.new(0, 2)
progressBarCorner.Parent = progressBar

-- Tạo hệ thống hạt hiệu ứng
local particles = {}
local particleCount = 50

local function createParticle()
    local particle = Instance.new("Frame")
    particle.Size = UDim2.new(0, math.random(2, 6), 0, math.random(2, 6))
    particle.Position = UDim2.new(math.random(), 0, math.random(), 0)
    particle.BackgroundColor3 = Color3.fromRGB(
        math.random(200, 255),
        math.random(200, 255), 
        math.random(240, 255)
    )
    particle.BorderSizePixel = 0
    particle.Parent = particleFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0.5, 0)
    corner.Parent = particle
    
    return particle
end

-- Tạo các hạt
if particleCount > 0 then
    for i = 1, particleCount do
        local particle = createParticle()
        table.insert(particles, particle)
    end
end

-- Animation progress bar
local function animateProgressBar()
    local progressInfo = TweenInfo.new(5, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
    local progressTween = TweenService:Create(progressBar, progressInfo, {
        Size = UDim2.new(1, 0, 1, 0)
    })
    progressTween:Play()
end

local function animateParticles()
    if #particles > 0 then
        for i, particle in ipairs(particles) do
            if particle and particle.Parent then
                local moveInfo = TweenInfo.new(
                    math.random(8, 15), 
                    Enum.EasingStyle.Linear, 
                    Enum.EasingDirection.InOut, 
                    -1
                )
                
                local newPos = UDim2.new(
                    math.random(), 0,
                    math.random(), 0
                )
                
                local moveTween = TweenService:Create(particle, moveInfo, {Position = newPos})
                moveTween:Play()
                
                -- Hiệu ứng fade
                local fadeInfo = TweenInfo.new(
                    math.random(3, 6),
                    Enum.EasingStyle.Sine,
                    Enum.EasingDirection.InOut,
                    -1, true
                )
                local fadeTween = TweenService:Create(particle, fadeInfo, {BackgroundTransparency = 0.7})
                fadeTween:Play()
            end
        end
    end
end

-- Bắt đầu animations
local function startLoadingAnimation()
    if centerFrame and cloudLogo then
        animateProgressBar()
        animateParticles()
    end
end

-- Function để tắt loading screen
local function hideLoadingScreen(duration)
    local hideInfo = TweenInfo.new(duration or 1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local hideTween = TweenService:Create(screenGui, hideInfo, {
        Enabled = false
    })
    
    hideTween:Play()
    
    hideTween.Completed:Connect(function()
        if loadingConnection then
            loadingConnection:Disconnect()
            loadingConnection = nil
        end
        if screenGui and screenGui.Parent then
            screenGui:Destroy()
        end
    end)
end

-- Bắt đầu animation
startLoadingAnimation()

-- Animation sequence trong 5 giây
local function startLoadingSequence()
    -- Logo xuất hiện (0-1 giây)
    cloudLogo.Size = UDim2.new(0, 0, 0, 0)
    cloudLogo.Rotation = -180
    
    local logoAppearInfo = TweenInfo.new(1, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    local logoAppearTween = TweenService:Create(cloudLogo, logoAppearInfo, {
        Size = UDim2.new(0, 160, 0, 100),
        Rotation = 0
    })
    logoAppearTween:Play()
    
    -- Chữ xuất hiện và xoay biến mất từ trái qua phải (1-4 giây)
    local letterDelay = 3 / #letters -- Chia đều 3 giây cho tất cả chữ
    
    for i, letter in ipairs(letters) do
        letter.TextTransparency = 1
        letter.Rotation = -90
        
        -- Xuất hiện
        local appearInfo = TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
        local appearTween = TweenService:Create(letter, appearInfo, {
            TextTransparency = 0,
            Rotation = 0
        })
        
        -- Biến mất với xoay
        local disappearInfo = TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In)
        local disappearTween = TweenService:Create(letter, disappearInfo, {
            TextTransparency = 1,
            Rotation = 90,
            Size = UDim2.new(0, letterWidth * 0.5, 1, 0)
        })
        
        -- Delay cho từng chữ
        wait(letterDelay * (i-1) + 1) -- +1 giây cho logo xuất hiện
        appearTween:Play()
        
        wait(0.8) -- Hiển thị chữ một lúc
        disappearTween:Play()
    end
    
    -- Logo biến mất (4-5 giây)
    wait(0.5)
    local logoDisappearInfo = TweenInfo.new(1, Enum.EasingStyle.Back, Enum.EasingDirection.In)
    local logoDisappearTween = TweenService:Create(cloudLogo, logoDisappearInfo, {
        Size = UDim2.new(0, 0, 0, 0),
        Rotation = 180
    })
    logoDisappearTween:Play()
    
    -- Ẩn toàn bộ loading screen
    wait(1)
    hideLoadingScreen(0.5)
end

-- Khởi động sequence
startLoadingSequence()

-- Export function để có thể gọi từ script khác
_G.hideLoadingScreen = hideLoadingScreen

print("Sky-Base-Maker Loading Animation đã được khởi tạo!")
